"use strict";
var THREE = require("three");
THREE.MTLLoader = function (manager) {
    this.manager = (manager !== undefined) ? manager : THREE.DefaultLoadingManager;
};
Object.assign(THREE.MTLLoader.prototype, THREE.EventDispatcher.prototype, {
    load: function (url, onLoad, onProgress, onError) {
        var scope = this;
        var loader = new THREE.FileLoader(this.manager);
        loader.setPath(this.path);
        loader.load(url, function (text) {
            onLoad(scope.parse(text));
        }, onProgress, onError);
    },
    setPath: function (path) {
        this.path = path;
    },
    setTexturePath: function (path) {
        this.texturePath = path;
    },
    setBaseUrl: function (path) {
        console.warn('THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.');
        this.setTexturePath(path);
    },
    setCrossOrigin: function (value) {
        this.crossOrigin = value;
    },
    setMaterialOptions: function (value) {
        this.materialOptions = value;
    },
    parse: function (text) {
        var lines = text.split('\n');
        var info = {};
        var delimiter_pattern = /\s+/;
        var materialsInfo = {};
        for (var i = 0; i < lines.length; i++) {
            var line = lines[i];
            line = line.trim();
            if (line.length === 0 || line.charAt(0) === '#') {
                continue;
            }
            var pos = line.indexOf(' ');
            var key = (pos >= 0) ? line.substring(0, pos) : line;
            key = key.toLowerCase();
            var value = (pos >= 0) ? line.substring(pos + 1) : '';
            value = value.trim();
            if (key === 'newmtl') {
                info = { name: value };
                materialsInfo[value] = info;
            }
            else if (info) {
                if (key === 'ka' || key === 'kd' || key === 'ks') {
                    var ss = value.split(delimiter_pattern, 3);
                    info[key] = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];
                }
                else {
                    info[key] = value;
                }
            }
        }
        var materialCreator = new THREE.MTLLoader.MaterialCreator(this.texturePath || this.path, this.materialOptions);
        materialCreator.setCrossOrigin(this.crossOrigin);
        materialCreator.setManager(this.manager);
        materialCreator.setMaterials(materialsInfo);
        return materialCreator;
    }
});
THREE.MTLLoader.MaterialCreator = function (baseUrl, options) {
    this.baseUrl = baseUrl || '';
    this.options = options;
    this.materialsInfo = {};
    this.materials = {};
    this.materialsArray = [];
    this.nameLookup = {};
    this.side = (this.options && this.options.side) ? this.options.side : THREE.FrontSide;
    this.wrap = (this.options && this.options.wrap) ? this.options.wrap : THREE.RepeatWrapping;
};
THREE.MTLLoader.MaterialCreator.prototype = {
    constructor: THREE.MTLLoader.MaterialCreator,
    setCrossOrigin: function (value) {
        this.crossOrigin = value;
    },
    setManager: function (value) {
        this.manager = value;
    },
    setMaterials: function (materialsInfo) {
        this.materialsInfo = this.convert(materialsInfo);
        this.materials = {};
        this.materialsArray = [];
        this.nameLookup = {};
    },
    convert: function (materialsInfo) {
        if (!this.options)
            return materialsInfo;
        var converted = {};
        for (var mn in materialsInfo) {
            var mat = materialsInfo[mn];
            var covmat = {};
            converted[mn] = covmat;
            for (var prop in mat) {
                var save = true;
                var value = mat[prop];
                var lprop = prop.toLowerCase();
                switch (lprop) {
                    case 'kd':
                    case 'ka':
                    case 'ks':
                        if (this.options && this.options.normalizeRGB) {
                            value = [value[0] / 255, value[1] / 255, value[2] / 255];
                        }
                        if (this.options && this.options.ignoreZeroRGBs) {
                            if (value[0] === 0 && value[1] === 0 && value[2] === 0) {
                                save = false;
                            }
                        }
                        break;
                    default:
                        break;
                }
                if (save) {
                    covmat[lprop] = value;
                }
            }
        }
        return converted;
    },
    preload: function () {
        for (var mn in this.materialsInfo) {
            this.create(mn);
        }
    },
    getIndex: function (materialName) {
        return this.nameLookup[materialName];
    },
    getAsArray: function () {
        var index = 0;
        for (var mn in this.materialsInfo) {
            this.materialsArray[index] = this.create(mn);
            this.nameLookup[mn] = index;
            index++;
        }
        return this.materialsArray;
    },
    create: function (materialName) {
        if (this.materials[materialName] === undefined) {
            this.createMaterial_(materialName);
        }
        return this.materials[materialName];
    },
    createMaterial_: function (materialName) {
        var scope = this;
        var mat = this.materialsInfo[materialName];
        var params = {
            name: materialName,
            side: this.side
        };
        var resolveURL = function (baseUrl, url) {
            if (typeof url !== 'string' || url === '')
                return '';
            if (/^https?:\/\//i.test(url)) {
                return url;
            }
            return baseUrl + url;
        };
        function setMapForType(mapType, value) {
            if (params[mapType])
                return;
            var texParams = scope.getTextureParams(value, params);
            var map = scope.loadTexture(resolveURL(scope.baseUrl, texParams.url));
            map.repeat.copy(texParams.scale);
            map.offset.copy(texParams.offset);
            map.wrapS = scope.wrap;
            map.wrapT = scope.wrap;
            params[mapType] = map;
        }
        for (var prop in mat) {
            var value = mat[prop];
            if (value === '')
                continue;
            switch (prop.toLowerCase()) {
                case 'kd':
                    params.color = new THREE.Color().fromArray(value);
                    break;
                case 'ks':
                    params.specular = new THREE.Color().fromArray(value);
                    break;
                case 'map_kd':
                    setMapForType("map", value);
                    break;
                case 'map_ks':
                    setMapForType("specularMap", value);
                    break;
                case 'map_bump':
                case 'bump':
                    setMapForType("bumpMap", value);
                    break;
                case 'ns':
                    params.shininess = parseFloat(value);
                    break;
                case 'd':
                    if (value < 1) {
                        params.opacity = value;
                        params.transparent = true;
                    }
                    break;
                case 'Tr':
                    if (value > 0) {
                        params.opacity = 1 - value;
                        params.transparent = true;
                    }
                    break;
                default:
                    break;
            }
        }
        this.materials[materialName] = new THREE.MeshPhongMaterial(params);
        return this.materials[materialName];
    },
    getTextureParams: function (value, matParams) {
        var texParams = {
            scale: new THREE.Vector2(1, 1),
            offset: new THREE.Vector2(0, 0)
        };
        var items = value.split(/\s+/);
        var pos;
        pos = items.indexOf('-bm');
        if (pos >= 0) {
            matParams.bumpScale = parseFloat(items[pos + 1]);
            items.splice(pos, 2);
        }
        pos = items.indexOf('-s');
        if (pos >= 0) {
            texParams.scale.set(parseFloat(items[pos + 1]), parseFloat(items[pos + 2]));
            items.splice(pos, 4);
        }
        pos = items.indexOf('-o');
        if (pos >= 0) {
            texParams.offset.set(parseFloat(items[pos + 1]), parseFloat(items[pos + 2]));
            items.splice(pos, 4);
        }
        texParams.url = items.join(' ').trim();
        return texParams;
    },
    loadTexture: function (url, mapping, onLoad, onProgress, onError) {
        var texture;
        var loader = THREE.Loader.Handlers.get(url);
        var manager = (this.manager !== undefined) ? this.manager : THREE.DefaultLoadingManager;
        if (loader === null) {
            loader = new THREE.TextureLoader(manager);
        }
        if (loader.setCrossOrigin)
            loader.setCrossOrigin(this.crossOrigin);
        texture = loader.load(url, onLoad, onProgress, onError);
        if (mapping !== undefined)
            texture.mapping = mapping;
        return texture;
    }
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzc2VydmljZS9tdGxMb2FkZXIuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBS0EsNkJBQStCO0FBRS9CLEtBQUssQ0FBQyxTQUFTLEdBQUcsVUFBVSxPQUFPO0lBRS9CLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBRSxPQUFPLEtBQUssU0FBUyxDQUFFLEdBQUcsT0FBTyxHQUFHLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQztBQUVyRixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFO0lBZXRFLElBQUksRUFBRSxVQUFVLEdBQUcsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE9BQU87UUFFNUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBRWpCLElBQUksTUFBTSxHQUFHLElBQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDaEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUIsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsVUFBVSxJQUFJO1lBRTNCLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFFOUIsQ0FBQyxFQUFFLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUU1QixDQUFDO0lBYUQsT0FBTyxFQUFFLFVBQVUsSUFBSTtRQUVuQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUVyQixDQUFDO0lBZUQsY0FBYyxFQUFFLFVBQVUsSUFBSTtRQUUxQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztJQUU1QixDQUFDO0lBRUQsVUFBVSxFQUFFLFVBQVUsSUFBSTtRQUV0QixPQUFPLENBQUMsSUFBSSxDQUFDLCtJQUErSSxDQUFDLENBQUM7UUFFOUos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QyxXQUFXLENBQUMsQ0FBQztRQUNuRSxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUV4RCxFQUFFLENBQUMsQ0FBQyxPQUFPLEtBQUssU0FBUyxDQUFDO1lBQUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFFckQsTUFBTSxDQUFDLE9BQU8sQ0FBQztJQUVuQixDQUFDO0NBRUosQ0FBQyIsImZpbGUiOiJqc3NlcnZpY2UvbXRsTG9hZGVyLnNlcnZpY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExvYWRzIGEgV2F2ZWZyb250IC5tdGwgZmlsZSBzcGVjaWZ5aW5nIG1hdGVyaWFsc1xuICpcbiAqIEBhdXRob3IgYW5nZWx4dWFuY2hhbmdcbiAqL1xuaW1wb3J0ICogYXMgVEhSRUUgZnJvbSAndGhyZWUnO1xuXG5USFJFRS5NVExMb2FkZXIgPSBmdW5jdGlvbiAobWFuYWdlcikge1xuXG4gICAgdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBUSFJFRS5EZWZhdWx0TG9hZGluZ01hbmFnZXI7XG5cbn07XG5cbk9iamVjdC5hc3NpZ24oVEhSRUUuTVRMTG9hZGVyLnByb3RvdHlwZSwgVEhSRUUuRXZlbnREaXNwYXRjaGVyLnByb3RvdHlwZSwge1xuXG4gICAgLyoqXG4gICAgICogTG9hZHMgYW5kIHBhcnNlcyBhIE1UTCBhc3NldCBmcm9tIGEgVVJMLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHVybCAtIFVSTCB0byB0aGUgTVRMIGZpbGUuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uTG9hZF0gLSBDYWxsYmFjayBpbnZva2VkIHdpdGggdGhlIGxvYWRlZCBvYmplY3QuXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW29uUHJvZ3Jlc3NdIC0gQ2FsbGJhY2sgZm9yIGRvd25sb2FkIHByb2dyZXNzLlxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtvbkVycm9yXSAtIENhbGxiYWNrIGZvciBkb3dubG9hZCBlcnJvcnMuXG4gICAgICpcbiAgICAgKiBAc2VlIHNldFBhdGggc2V0VGV4dHVyZVBhdGhcbiAgICAgKlxuICAgICAqIEBub3RlIEluIG9yZGVyIGZvciByZWxhdGl2ZSB0ZXh0dXJlIHJlZmVyZW5jZXMgdG8gcmVzb2x2ZSBjb3JyZWN0bHlcbiAgICAgKiB5b3UgbXVzdCBjYWxsIHNldFBhdGggYW5kL29yIHNldFRleHR1cmVQYXRoIGV4cGxpY2l0bHkgcHJpb3IgdG8gbG9hZC5cbiAgICAgKi9cbiAgICBsb2FkOiBmdW5jdGlvbiAodXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpIHtcblxuICAgICAgICB2YXIgc2NvcGUgPSB0aGlzO1xuXG4gICAgICAgIHZhciBsb2FkZXIgPSBuZXcgVEhSRUUuRmlsZUxvYWRlcih0aGlzLm1hbmFnZXIpO1xuICAgICAgICBsb2FkZXIuc2V0UGF0aCh0aGlzLnBhdGgpO1xuICAgICAgICBsb2FkZXIubG9hZCh1cmwsIGZ1bmN0aW9uICh0ZXh0KSB7XG5cbiAgICAgICAgICAgIG9uTG9hZChzY29wZS5wYXJzZSh0ZXh0KSk7XG5cbiAgICAgICAgfSwgb25Qcm9ncmVzcywgb25FcnJvcik7XG5cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2V0IGJhc2UgcGF0aCBmb3IgcmVzb2x2aW5nIHJlZmVyZW5jZXMuXG4gICAgICogSWYgc2V0IHRoaXMgcGF0aCB3aWxsIGJlIHByZXBlbmRlZCB0byBlYWNoIGxvYWRlZCBhbmQgZm91bmQgcmVmZXJlbmNlLlxuICAgICAqXG4gICAgICogQHNlZSBzZXRUZXh0dXJlUGF0aFxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwYXRoXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqICAgICBtdGxMb2FkZXIuc2V0UGF0aCggJ2Fzc2V0cy9vYmovJyApO1xuICAgICAqICAgICBtdGxMb2FkZXIubG9hZCggJ215Lm10bCcsIC4uLiApO1xuICAgICAqL1xuICAgIHNldFBhdGg6IGZ1bmN0aW9uIChwYXRoKSB7XG5cbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTZXQgYmFzZSBwYXRoIGZvciByZXNvbHZpbmcgdGV4dHVyZSByZWZlcmVuY2VzLlxuICAgICAqIElmIHNldCB0aGlzIHBhdGggd2lsbCBiZSBwcmVwZW5kZWQgZm91bmQgdGV4dHVyZSByZWZlcmVuY2UuXG4gICAgICogSWYgbm90IHNldCBhbmQgc2V0UGF0aCBpcywgaXQgd2lsbCBiZSB1c2VkIGFzIHRleHR1cmUgYmFzZSBwYXRoLlxuICAgICAqXG4gICAgICogQHNlZSBzZXRQYXRoXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHBhdGhcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogICAgIG10bExvYWRlci5zZXRQYXRoKCAnYXNzZXRzL29iai8nICk7XG4gICAgICogICAgIG10bExvYWRlci5zZXRUZXh0dXJlUGF0aCggJ2Fzc2V0cy90ZXh0dXJlcy8nICk7XG4gICAgICogICAgIG10bExvYWRlci5sb2FkKCAnbXkubXRsJywgLi4uICk7XG4gICAgICovXG4gICAgc2V0VGV4dHVyZVBhdGg6IGZ1bmN0aW9uIChwYXRoKSB7XG5cbiAgICAgICAgdGhpcy50ZXh0dXJlUGF0aCA9IHBhdGg7XG5cbiAgICB9LFxuXG4gICAgc2V0QmFzZVVybDogZnVuY3Rpb24gKHBhdGgpIHtcblxuICAgICAgICBjb25zb2xlLndhcm4oJ1RIUkVFLk1UTExvYWRlcjogLnNldEJhc2VVcmwoKSBpcyBkZXByZWNhdGVkLiBVc2UgLnNldFRleHR1cmVQYXRoKCBwYXRoICkgZm9yIHRleHR1cmUgcGF0aCBvciAuc2V0UGF0aCggcGF0aCApIGZvciBnZW5lcmFsIGJhc2UgcGF0aCBpbnN0ZWFkLicpO1xuXG4gICAgICAgIHRoaXMuc2V0VGV4dHVyZVBhdGgocGF0aCk7XG5cbiAgICB9LFxuXG4gICAgc2V0Q3Jvc3NPcmlnaW46IGZ1bmN0aW9uICh2YWx1ZSkge1xuXG4gICAgICAgIHRoaXMuY3Jvc3NPcmlnaW4gPSB2YWx1ZTtcblxuICAgIH0sXG5cbiAgICBzZXRNYXRlcmlhbE9wdGlvbnM6IGZ1bmN0aW9uICh2YWx1ZSkge1xuXG4gICAgICAgIHRoaXMubWF0ZXJpYWxPcHRpb25zID0gdmFsdWU7XG5cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgTVRMIGZpbGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCAtIENvbnRlbnQgb2YgTVRMIGZpbGVcbiAgICAgKiBAcmV0dXJuIHtUSFJFRS5NVExMb2FkZXIuTWF0ZXJpYWxDcmVhdG9yfVxuICAgICAqXG4gICAgICogQHNlZSBzZXRQYXRoIHNldFRleHR1cmVQYXRoXG4gICAgICpcbiAgICAgKiBAbm90ZSBJbiBvcmRlciBmb3IgcmVsYXRpdmUgdGV4dHVyZSByZWZlcmVuY2VzIHRvIHJlc29sdmUgY29ycmVjdGx5XG4gICAgICogeW91IG11c3QgY2FsbCBzZXRQYXRoIGFuZC9vciBzZXRUZXh0dXJlUGF0aCBleHBsaWNpdGx5IHByaW9yIHRvIHBhcnNlLlxuICAgICAqL1xuICAgIHBhcnNlOiBmdW5jdGlvbiAodGV4dCkge1xuXG4gICAgICAgIHZhciBsaW5lcyA9IHRleHQuc3BsaXQoJ1xcbicpO1xuICAgICAgICB2YXIgaW5mbyA9IHt9O1xuICAgICAgICB2YXIgZGVsaW1pdGVyX3BhdHRlcm4gPSAvXFxzKy87XG4gICAgICAgIHZhciBtYXRlcmlhbHNJbmZvID0ge307XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICB2YXIgbGluZSA9IGxpbmVzW2ldO1xuICAgICAgICAgICAgbGluZSA9IGxpbmUudHJpbSgpO1xuXG4gICAgICAgICAgICBpZiAobGluZS5sZW5ndGggPT09IDAgfHwgbGluZS5jaGFyQXQoMCkgPT09ICcjJykge1xuXG4gICAgICAgICAgICAgICAgLy8gQmxhbmsgbGluZSBvciBjb21tZW50IGlnbm9yZVxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZhciBwb3MgPSBsaW5lLmluZGV4T2YoJyAnKTtcblxuICAgICAgICAgICAgdmFyIGtleSA9ICggcG9zID49IDAgKSA/IGxpbmUuc3Vic3RyaW5nKDAsIHBvcykgOiBsaW5lO1xuICAgICAgICAgICAga2V5ID0ga2V5LnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZSA9ICggcG9zID49IDAgKSA/IGxpbmUuc3Vic3RyaW5nKHBvcyArIDEpIDogJyc7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcblxuICAgICAgICAgICAgaWYgKGtleSA9PT0gJ25ld210bCcpIHtcblxuICAgICAgICAgICAgICAgIC8vIE5ldyBtYXRlcmlhbFxuXG4gICAgICAgICAgICAgICAgaW5mbyA9IHtuYW1lOiB2YWx1ZX07XG4gICAgICAgICAgICAgICAgbWF0ZXJpYWxzSW5mb1t2YWx1ZV0gPSBpbmZvO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGluZm8pIHtcblxuICAgICAgICAgICAgICAgIGlmIChrZXkgPT09ICdrYScgfHwga2V5ID09PSAna2QnIHx8IGtleSA9PT0gJ2tzJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBzcyA9IHZhbHVlLnNwbGl0KGRlbGltaXRlcl9wYXR0ZXJuLCAzKTtcbiAgICAgICAgICAgICAgICAgICAgaW5mb1trZXldID0gW3BhcnNlRmxvYXQoc3NbMF0pLCBwYXJzZUZsb2F0KHNzWzFdKSwgcGFyc2VGbG9hdChzc1syXSldO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBpbmZvW2tleV0gPSB2YWx1ZTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbWF0ZXJpYWxDcmVhdG9yID0gbmV3IFRIUkVFLk1UTExvYWRlci5NYXRlcmlhbENyZWF0b3IodGhpcy50ZXh0dXJlUGF0aCB8fCB0aGlzLnBhdGgsIHRoaXMubWF0ZXJpYWxPcHRpb25zKTtcbiAgICAgICAgbWF0ZXJpYWxDcmVhdG9yLnNldENyb3NzT3JpZ2luKHRoaXMuY3Jvc3NPcmlnaW4pO1xuICAgICAgICBtYXRlcmlhbENyZWF0b3Iuc2V0TWFuYWdlcih0aGlzLm1hbmFnZXIpO1xuICAgICAgICBtYXRlcmlhbENyZWF0b3Iuc2V0TWF0ZXJpYWxzKG1hdGVyaWFsc0luZm8pO1xuICAgICAgICByZXR1cm4gbWF0ZXJpYWxDcmVhdG9yO1xuXG4gICAgfVxuXG59KTtcblxuLyoqXG4gKiBDcmVhdGUgYSBuZXcgVEhSRUUtTVRMTG9hZGVyLk1hdGVyaWFsQ3JlYXRvclxuICogQHBhcmFtIGJhc2VVcmwgLSBVcmwgcmVsYXRpdmUgdG8gd2hpY2ggdGV4dHVyZXMgYXJlIGxvYWRlZFxuICogQHBhcmFtIG9wdGlvbnMgLSBTZXQgb2Ygb3B0aW9ucyBvbiBob3cgdG8gY29uc3RydWN0IHRoZSBtYXRlcmlhbHNcbiAqICAgICAgICAgICAgICAgICAgc2lkZTogV2hpY2ggc2lkZSB0byBhcHBseSB0aGUgbWF0ZXJpYWxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgVEhSRUUuRnJvbnRTaWRlIChkZWZhdWx0KSwgVEhSRUUuQmFja1NpZGUsIFRIUkVFLkRvdWJsZVNpZGVcbiAqICAgICAgICAgICAgICAgICAgd3JhcDogV2hhdCB0eXBlIG9mIHdyYXBwaW5nIHRvIGFwcGx5IGZvciB0ZXh0dXJlc1xuICogICAgICAgICAgICAgICAgICAgICAgICBUSFJFRS5SZXBlYXRXcmFwcGluZyAoZGVmYXVsdCksIFRIUkVFLkNsYW1wVG9FZGdlV3JhcHBpbmcsIFRIUkVFLk1pcnJvcmVkUmVwZWF0V3JhcHBpbmdcbiAqICAgICAgICAgICAgICAgICAgbm9ybWFsaXplUkdCOiBSR0JzIG5lZWQgdG8gYmUgbm9ybWFsaXplZCB0byAwLTEgZnJvbSAwLTI1NVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlZmF1bHQ6IGZhbHNlLCBhc3N1bWVkIHRvIGJlIGFscmVhZHkgbm9ybWFsaXplZFxuICogICAgICAgICAgICAgICAgICBpZ25vcmVaZXJvUkdCczogSWdub3JlIHZhbHVlcyBvZiBSR0JzIChLYSxLZCxLcykgdGhhdCBhcmUgYWxsIDAnc1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVmYXVsdDogZmFsc2VcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5cblRIUkVFLk1UTExvYWRlci5NYXRlcmlhbENyZWF0b3IgPSBmdW5jdGlvbiAoYmFzZVVybCwgb3B0aW9ucykge1xuXG4gICAgdGhpcy5iYXNlVXJsID0gYmFzZVVybCB8fCAnJztcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIHRoaXMubWF0ZXJpYWxzSW5mbyA9IHt9O1xuICAgIHRoaXMubWF0ZXJpYWxzID0ge307XG4gICAgdGhpcy5tYXRlcmlhbHNBcnJheSA9IFtdO1xuICAgIHRoaXMubmFtZUxvb2t1cCA9IHt9O1xuXG4gICAgdGhpcy5zaWRlID0gKCB0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLnNpZGUgKSA/IHRoaXMub3B0aW9ucy5zaWRlIDogVEhSRUUuRnJvbnRTaWRlO1xuICAgIHRoaXMud3JhcCA9ICggdGhpcy5vcHRpb25zICYmIHRoaXMub3B0aW9ucy53cmFwICkgPyB0aGlzLm9wdGlvbnMud3JhcCA6IFRIUkVFLlJlcGVhdFdyYXBwaW5nO1xuXG59O1xuXG5USFJFRS5NVExMb2FkZXIuTWF0ZXJpYWxDcmVhdG9yLnByb3RvdHlwZSA9IHtcblxuICAgIGNvbnN0cnVjdG9yOiBUSFJFRS5NVExMb2FkZXIuTWF0ZXJpYWxDcmVhdG9yLFxuXG4gICAgc2V0Q3Jvc3NPcmlnaW46IGZ1bmN0aW9uICh2YWx1ZSkge1xuXG4gICAgICAgIHRoaXMuY3Jvc3NPcmlnaW4gPSB2YWx1ZTtcblxuICAgIH0sXG5cbiAgICBzZXRNYW5hZ2VyOiBmdW5jdGlvbiAodmFsdWUpIHtcblxuICAgICAgICB0aGlzLm1hbmFnZXIgPSB2YWx1ZTtcblxuICAgIH0sXG5cbiAgICBzZXRNYXRlcmlhbHM6IGZ1bmN0aW9uIChtYXRlcmlhbHNJbmZvKSB7XG5cbiAgICAgICAgdGhpcy5tYXRlcmlhbHNJbmZvID0gdGhpcy5jb252ZXJ0KG1hdGVyaWFsc0luZm8pO1xuICAgICAgICB0aGlzLm1hdGVyaWFscyA9IHt9O1xuICAgICAgICB0aGlzLm1hdGVyaWFsc0FycmF5ID0gW107XG4gICAgICAgIHRoaXMubmFtZUxvb2t1cCA9IHt9O1xuXG4gICAgfSxcblxuICAgIGNvbnZlcnQ6IGZ1bmN0aW9uIChtYXRlcmlhbHNJbmZvKSB7XG5cbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMpIHJldHVybiBtYXRlcmlhbHNJbmZvO1xuXG4gICAgICAgIHZhciBjb252ZXJ0ZWQgPSB7fTtcblxuICAgICAgICBmb3IgKHZhciBtbiBpbiBtYXRlcmlhbHNJbmZvKSB7XG5cbiAgICAgICAgICAgIC8vIENvbnZlcnQgbWF0ZXJpYWxzIGluZm8gaW50byBub3JtYWxpemVkIGZvcm0gYmFzZWQgb24gb3B0aW9uc1xuXG4gICAgICAgICAgICB2YXIgbWF0ID0gbWF0ZXJpYWxzSW5mb1ttbl07XG5cbiAgICAgICAgICAgIHZhciBjb3ZtYXQgPSB7fTtcblxuICAgICAgICAgICAgY29udmVydGVkW21uXSA9IGNvdm1hdDtcblxuICAgICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBtYXQpIHtcblxuICAgICAgICAgICAgICAgIHZhciBzYXZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBtYXRbcHJvcF07XG4gICAgICAgICAgICAgICAgdmFyIGxwcm9wID0gcHJvcC50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgICAgICAgICAgc3dpdGNoIChscHJvcCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2tkJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAna2EnOlxuICAgICAgICAgICAgICAgICAgICBjYXNlICdrcyc6XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpZmZ1c2UgY29sb3IgKGNvbG9yIHVuZGVyIHdoaXRlIGxpZ2h0KSB1c2luZyBSR0IgdmFsdWVzXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMgJiYgdGhpcy5vcHRpb25zLm5vcm1hbGl6ZVJHQikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBbdmFsdWVbMF0gLyAyNTUsIHZhbHVlWzFdIC8gMjU1LCB2YWx1ZVsyXSAvIDI1NV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMuaWdub3JlWmVyb1JHQnMpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZVswXSA9PT0gMCAmJiB2YWx1ZVsxXSA9PT0gMCAmJiB2YWx1ZVsyXSA9PT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoc2F2ZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGNvdm1hdFtscHJvcF0gPSB2YWx1ZTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY29udmVydGVkO1xuXG4gICAgfSxcblxuICAgIHByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICBmb3IgKHZhciBtbiBpbiB0aGlzLm1hdGVyaWFsc0luZm8pIHtcblxuICAgICAgICAgICAgdGhpcy5jcmVhdGUobW4pO1xuXG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICBnZXRJbmRleDogZnVuY3Rpb24gKG1hdGVyaWFsTmFtZSkge1xuXG4gICAgICAgIHJldHVybiB0aGlzLm5hbWVMb29rdXBbbWF0ZXJpYWxOYW1lXTtcblxuICAgIH0sXG5cbiAgICBnZXRBc0FycmF5OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgdmFyIGluZGV4ID0gMDtcblxuICAgICAgICBmb3IgKHZhciBtbiBpbiB0aGlzLm1hdGVyaWFsc0luZm8pIHtcblxuICAgICAgICAgICAgdGhpcy5tYXRlcmlhbHNBcnJheVtpbmRleF0gPSB0aGlzLmNyZWF0ZShtbik7XG4gICAgICAgICAgICB0aGlzLm5hbWVMb29rdXBbbW5dID0gaW5kZXg7XG4gICAgICAgICAgICBpbmRleCsrO1xuXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5tYXRlcmlhbHNBcnJheTtcblxuICAgIH0sXG5cbiAgICBjcmVhdGU6IGZ1bmN0aW9uIChtYXRlcmlhbE5hbWUpIHtcblxuICAgICAgICBpZiAodGhpcy5tYXRlcmlhbHNbbWF0ZXJpYWxOYW1lXSA9PT0gdW5kZWZpbmVkKSB7XG5cbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTWF0ZXJpYWxfKG1hdGVyaWFsTmFtZSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLm1hdGVyaWFsc1ttYXRlcmlhbE5hbWVdO1xuXG4gICAgfSxcblxuICAgIGNyZWF0ZU1hdGVyaWFsXzogZnVuY3Rpb24gKG1hdGVyaWFsTmFtZSkge1xuXG4gICAgICAgIC8vIENyZWF0ZSBtYXRlcmlhbFxuXG4gICAgICAgIHZhciBzY29wZSA9IHRoaXM7XG4gICAgICAgIHZhciBtYXQgPSB0aGlzLm1hdGVyaWFsc0luZm9bbWF0ZXJpYWxOYW1lXTtcbiAgICAgICAgdmFyIHBhcmFtczogYW55ID0ge1xuXG4gICAgICAgICAgICBuYW1lOiBtYXRlcmlhbE5hbWUsXG4gICAgICAgICAgICBzaWRlOiB0aGlzLnNpZGVcblxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciByZXNvbHZlVVJMID0gZnVuY3Rpb24gKGJhc2VVcmwsIHVybCkge1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHVybCAhPT0gJ3N0cmluZycgfHwgdXJsID09PSAnJylcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG5cbiAgICAgICAgICAgIC8vIEFic29sdXRlIFVSTFxuICAgICAgICAgICAgaWYgKC9eaHR0cHM/OlxcL1xcLy9pLnRlc3QodXJsKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBiYXNlVXJsICsgdXJsO1xuICAgICAgICB9O1xuXG4gICAgICAgIGZ1bmN0aW9uIHNldE1hcEZvclR5cGUobWFwVHlwZSwgdmFsdWUpIHtcblxuICAgICAgICAgICAgaWYgKHBhcmFtc1ttYXBUeXBlXSkgcmV0dXJuOyAvLyBLZWVwIHRoZSBmaXJzdCBlbmNvdW50ZXJlZCB0ZXh0dXJlXG5cbiAgICAgICAgICAgIHZhciB0ZXhQYXJhbXMgPSBzY29wZS5nZXRUZXh0dXJlUGFyYW1zKHZhbHVlLCBwYXJhbXMpO1xuICAgICAgICAgICAgdmFyIG1hcCA9IHNjb3BlLmxvYWRUZXh0dXJlKHJlc29sdmVVUkwoc2NvcGUuYmFzZVVybCwgdGV4UGFyYW1zLnVybCkpO1xuXG4gICAgICAgICAgICBtYXAucmVwZWF0LmNvcHkodGV4UGFyYW1zLnNjYWxlKTtcbiAgICAgICAgICAgIG1hcC5vZmZzZXQuY29weSh0ZXhQYXJhbXMub2Zmc2V0KTtcblxuICAgICAgICAgICAgbWFwLndyYXBTID0gc2NvcGUud3JhcDtcbiAgICAgICAgICAgIG1hcC53cmFwVCA9IHNjb3BlLndyYXA7XG5cbiAgICAgICAgICAgIHBhcmFtc1ttYXBUeXBlXSA9IG1hcDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gbWF0KSB7XG5cbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG1hdFtwcm9wXTtcblxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSAnJykgY29udGludWU7XG5cbiAgICAgICAgICAgIHN3aXRjaCAocHJvcC50b0xvd2VyQ2FzZSgpKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBOcyBpcyBtYXRlcmlhbCBzcGVjdWxhciBleHBvbmVudFxuXG4gICAgICAgICAgICAgICAgY2FzZSAna2QnOlxuXG4gICAgICAgICAgICAgICAgICAgIC8vIERpZmZ1c2UgY29sb3IgKGNvbG9yIHVuZGVyIHdoaXRlIGxpZ2h0KSB1c2luZyBSR0IgdmFsdWVzXG5cbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zLmNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuZnJvbUFycmF5KHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2tzJzpcblxuICAgICAgICAgICAgICAgICAgICAvLyBTcGVjdWxhciBjb2xvciAoY29sb3Igd2hlbiBsaWdodCBpcyByZWZsZWN0ZWQgZnJvbSBzaGlueSBzdXJmYWNlKSB1c2luZyBSR0IgdmFsdWVzXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5zcGVjdWxhciA9IG5ldyBUSFJFRS5Db2xvcigpLmZyb21BcnJheSh2YWx1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdtYXBfa2QnOlxuXG4gICAgICAgICAgICAgICAgICAgIC8vIERpZmZ1c2UgdGV4dHVyZSBtYXBcblxuICAgICAgICAgICAgICAgICAgICBzZXRNYXBGb3JUeXBlKFwibWFwXCIsIHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ21hcF9rcyc6XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU3BlY3VsYXIgbWFwXG5cbiAgICAgICAgICAgICAgICAgICAgc2V0TWFwRm9yVHlwZShcInNwZWN1bGFyTWFwXCIsIHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ21hcF9idW1wJzpcbiAgICAgICAgICAgICAgICBjYXNlICdidW1wJzpcblxuICAgICAgICAgICAgICAgICAgICAvLyBCdW1wIHRleHR1cmUgbWFwXG5cbiAgICAgICAgICAgICAgICAgICAgc2V0TWFwRm9yVHlwZShcImJ1bXBNYXBcIiwgdmFsdWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnbnMnOlxuXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBzcGVjdWxhciBleHBvbmVudCAoZGVmaW5lcyB0aGUgZm9jdXMgb2YgdGhlIHNwZWN1bGFyIGhpZ2hsaWdodClcbiAgICAgICAgICAgICAgICAgICAgLy8gQSBoaWdoIGV4cG9uZW50IHJlc3VsdHMgaW4gYSB0aWdodCwgY29uY2VudHJhdGVkIGhpZ2hsaWdodC4gTnMgdmFsdWVzIG5vcm1hbGx5IHJhbmdlIGZyb20gMCB0byAxMDAwLlxuXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcy5zaGluaW5lc3MgPSBwYXJzZUZsb2F0KHZhbHVlKTtcblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGNhc2UgJ2QnOlxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLm9wYWNpdHkgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtcy50cmFuc3BhcmVudCA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnVHInOlxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLm9wYWNpdHkgPSAxIC0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMudHJhbnNwYXJlbnQgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubWF0ZXJpYWxzW21hdGVyaWFsTmFtZV0gPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwocGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0ZXJpYWxzW21hdGVyaWFsTmFtZV07XG4gICAgfSxcblxuICAgIGdldFRleHR1cmVQYXJhbXM6IGZ1bmN0aW9uICh2YWx1ZSwgbWF0UGFyYW1zKSB7XG5cbiAgICAgICAgdmFyIHRleFBhcmFtczogYW55ID0ge1xuXG4gICAgICAgICAgICBzY2FsZTogbmV3IFRIUkVFLlZlY3RvcjIoMSwgMSksXG4gICAgICAgICAgICBvZmZzZXQ6IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApXG5cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgaXRlbXMgPSB2YWx1ZS5zcGxpdCgvXFxzKy8pO1xuICAgICAgICB2YXIgcG9zO1xuXG4gICAgICAgIHBvcyA9IGl0ZW1zLmluZGV4T2YoJy1ibScpO1xuICAgICAgICBpZiAocG9zID49IDApIHtcblxuICAgICAgICAgICAgbWF0UGFyYW1zLmJ1bXBTY2FsZSA9IHBhcnNlRmxvYXQoaXRlbXNbcG9zICsgMV0pO1xuICAgICAgICAgICAgaXRlbXMuc3BsaWNlKHBvcywgMik7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHBvcyA9IGl0ZW1zLmluZGV4T2YoJy1zJyk7XG4gICAgICAgIGlmIChwb3MgPj0gMCkge1xuXG4gICAgICAgICAgICB0ZXhQYXJhbXMuc2NhbGUuc2V0KHBhcnNlRmxvYXQoaXRlbXNbcG9zICsgMV0pLCBwYXJzZUZsb2F0KGl0ZW1zW3BvcyArIDJdKSk7XG4gICAgICAgICAgICBpdGVtcy5zcGxpY2UocG9zLCA0KTsgLy8gd2UgZXhwZWN0IDMgcGFyYW1ldGVycyBoZXJlIVxuXG4gICAgICAgIH1cblxuICAgICAgICBwb3MgPSBpdGVtcy5pbmRleE9mKCctbycpO1xuICAgICAgICBpZiAocG9zID49IDApIHtcblxuICAgICAgICAgICAgdGV4UGFyYW1zLm9mZnNldC5zZXQocGFyc2VGbG9hdChpdGVtc1twb3MgKyAxXSksIHBhcnNlRmxvYXQoaXRlbXNbcG9zICsgMl0pKTtcbiAgICAgICAgICAgIGl0ZW1zLnNwbGljZShwb3MsIDQpOyAvLyB3ZSBleHBlY3QgMyBwYXJhbWV0ZXJzIGhlcmUhXG5cbiAgICAgICAgfVxuXG4gICAgICAgIHRleFBhcmFtcy51cmwgPSBpdGVtcy5qb2luKCcgJykudHJpbSgpO1xuICAgICAgICByZXR1cm4gdGV4UGFyYW1zO1xuXG4gICAgfSxcblxuICAgIGxvYWRUZXh0dXJlOiBmdW5jdGlvbiAodXJsLCBtYXBwaW5nLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpIHtcblxuICAgICAgICB2YXIgdGV4dHVyZTtcbiAgICAgICAgdmFyIGxvYWRlciA9IFRIUkVFLkxvYWRlci5IYW5kbGVycy5nZXQodXJsKTtcbiAgICAgICAgdmFyIG1hbmFnZXIgPSAoIHRoaXMubWFuYWdlciAhPT0gdW5kZWZpbmVkICkgPyB0aGlzLm1hbmFnZXIgOiBUSFJFRS5EZWZhdWx0TG9hZGluZ01hbmFnZXI7XG5cbiAgICAgICAgaWYgKGxvYWRlciA9PT0gbnVsbCkge1xuXG4gICAgICAgICAgICBsb2FkZXIgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcihtYW5hZ2VyKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxvYWRlci5zZXRDcm9zc09yaWdpbikgbG9hZGVyLnNldENyb3NzT3JpZ2luKHRoaXMuY3Jvc3NPcmlnaW4pO1xuICAgICAgICB0ZXh0dXJlID0gbG9hZGVyLmxvYWQodXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IpO1xuXG4gICAgICAgIGlmIChtYXBwaW5nICE9PSB1bmRlZmluZWQpIHRleHR1cmUubWFwcGluZyA9IG1hcHBpbmc7XG5cbiAgICAgICAgcmV0dXJuIHRleHR1cmU7XG5cbiAgICB9XG5cbn07XG4iXX0=
