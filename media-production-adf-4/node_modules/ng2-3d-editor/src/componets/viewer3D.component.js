"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require("@angular/core");
var editorControls_1 = require("../controllers/editorControls");
var THREE = require('three');
var FBXLoaderService = require('../jsservice/fbxLoader2.service.js');
var TransformControls = require('three-transformcontrols');
var ObjLoaderService = require('../jsservice/objLoader.service');
var MtlLoaderService = require('../jsservice/mtlLoader.service');
var Viewer3DComponent = (function () {
    function Viewer3DComponent() {
        this.enableTransformController = true;
        this.inGenerate = false;
        this.mouseX = 0;
        this.mouseY = 0;
        this.center = new THREE.Vector3();
        this.loading = true;
    }
    Viewer3DComponent.prototype.ngOnInit = function () {
        var _this = this;
        console.log(ObjLoaderService);
        console.log(MtlLoaderService);
        console.log(FBXLoaderService);
        console.log(TransformControls);
        this.container = document.getElementById('viewer-3d');
        this.camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
        this.camera.position.z = 250;
        this.scene = new THREE.Scene();
        this.lights();
        this.grid();
        this.axisHelper();
        if (!this.extension) {
            this.extension = this.getFileExtension(this.urlFile);
        }
        if (this.extension === 'obj') {
            this.loadObjFormatFile();
        }
        else if (this.extension === 'fbx') {
            this.loadFbxFormatFile();
        }
        this.renderer = new THREE.WebGLRenderer();
        this.renderer.setPixelRatio(window.devicePixelRatio);
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        if (this.clearColor) {
            this.renderer.setClearColor(this.clearColor);
        }
        this.container.appendChild(this.renderer.domElement);
        this.animate();
        if (this.enableTransformController) {
            this.transformControl = new TransformControls(this.camera, this.renderer.domElement);
            this.transformControl.addEventListener('change', this.render.bind(this));
        }
        this.controllers = new editorControls_1.EditorControls(this.container, this.camera);
        window.addEventListener('resize', this.onWindowResize.bind(this), false);
        window.addEventListener('keydown', function (event) {
            switch (event.keyCode) {
                case 81:
                    _this.transformControl.setSpace(_this.transformControl.space === 'local' ? 'world' : 'local');
                    break;
                case 17:
                    _this.transformControl.setTranslationSnap(100);
                    _this.transformControl.setRotationSnap(THREE.Math.degToRad(15));
                    break;
                case 87:
                    _this.transformControl.setMode('translate');
                    break;
                case 69:
                    _this.transformControl.setMode('rotate');
                    break;
                case 82:
                    _this.transformControl.setMode('scale');
                    break;
                case 187:
                case 107:
                    _this.transformControl.setSize(_this.transformControl.size + 0.1);
                    break;
                case 189:
                case 109:
                    _this.transformControl.setSize(Math.max(_this.transformControl.size - 0.1, 0.1));
                    break;
                default:
                    break;
            }
        });
        window.addEventListener('keyup', function (event) {
            switch (event.keyCode) {
                case 17:
                    _this.transformControl.setTranslationSnap(null);
                    _this.transformControl.setRotationSnap(null);
                    break;
                default:
                    break;
            }
        });
    };
    Viewer3DComponent.prototype.lights = function () {
        var ambient = new THREE.AmbientLight(0x444444);
        var directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(1, 1, 1).normalize();
        var helper = new THREE.DirectionalLightHelper(directionalLight, 5);
        this.scene.add(ambient);
        this.scene.add(helper);
        this.scene.add(directionalLight);
    };
    Viewer3DComponent.prototype.axisHelper = function () {
        var axisHelper = new THREE.AxisHelper(5);
        this.scene.add(axisHelper);
    };
    Viewer3DComponent.prototype.grid = function () {
        var lineMaterial = new THREE.LineBasicMaterial({ color: 0x303030 }), geometry = new THREE.Geometry(), floor = -75, step = 25;
        for (var i = 0; i <= 40; i++) {
            geometry.vertices.push(new THREE.Vector3(-500, floor, i * step - 500));
            geometry.vertices.push(new THREE.Vector3(500, floor, i * step - 500));
            geometry.vertices.push(new THREE.Vector3(i * step - 500, floor, -500));
            geometry.vertices.push(new THREE.Vector3(i * step - 500, floor, 500));
        }
        var line = new THREE.LineSegments(geometry, lineMaterial);
        this.scene.add(line);
    };
    Viewer3DComponent.prototype.loadObjFormatFile = function () {
        var _this = this;
        var mtlLoader = new THREE.MTLLoader();
        this.setDetailLoad('MATERIALS');
        mtlLoader.load(this.urlFile.replace('.obj', '.mtl'), function (materials) {
            _this.loadObj(materials);
        }, function (progress) {
            console.log('progress material loader' + JSON.stringify(progress));
        }, function (error) {
            console.log('error material loader' + error);
            _this.loadObj(null);
        });
    };
    Viewer3DComponent.prototype.loadFbxFormatFile = function () {
        var _this = this;
        this.setDetailLoad('FBX OBJECTS');
        var manager = new THREE.LoadingManager();
        manager.onProgress = function (item, loaded, total) {
            console.log(item, loaded, total);
        };
        var loader = new THREE.FBXLoader(manager);
        loader.load(this.urlFile, function (object) {
            _this.loading = false;
            object.mixer = new THREE.AnimationMixer(object);
            var action = object.mixer.clipAction(object.animations[0]);
            action.play();
            _this.scene.add(object);
            if (_this.enableTransformController) {
                _this.transformControl.attach(object);
                _this.scene.add(_this.transformControl);
            }
        }, function (progress) {
            console.log('progress fbx loader' + JSON.stringify(progress));
        }, function (error) {
            console.log('error' + error);
        });
    };
    Viewer3DComponent.prototype.loadObj = function (materials) {
        var _this = this;
        var objLoader = new THREE.OBJLoader();
        if (materials) {
            materials.preload();
            objLoader.setMaterials(materials);
        }
        this.setDetailLoad('OBJ OBJECTS');
        objLoader.load(this.urlFile, function (object) {
            _this.loading = false;
            _this.scene.add(object);
            if (_this.enableTransformController) {
                _this.transformControl.attach(object);
                _this.scene.add(_this.transformControl);
            }
            _this.cameraPositioning();
        }, function (progress) {
            console.log('progress obj loader' + JSON.stringify(progress));
        }, function (error) {
            console.log('error' + error);
        });
    };
    Viewer3DComponent.prototype.cameraPositioning = function () {
        if (this.initialPositionCamera) {
            this.camera.position.set(this.initialPositionCamera.x, this.initialPositionCamera.y, this.initialPositionCamera.z);
        }
        if (this.initialRotationCamera) {
            this.camera.rotation.set(this.initialRotationCamera.x, this.initialRotationCamera.y, this.initialRotationCamera.z);
        }
        this.camera.lookAt(this.center);
    };
    Viewer3DComponent.prototype.setDetailLoad = function (detail) {
        this.detailLoading = detail;
    };
    ;
    Viewer3DComponent.prototype.animate = function () {
        requestAnimationFrame(this.animate.bind(this));
        this.render();
    };
    Viewer3DComponent.prototype.onWindowResize = function () {
        this.windowHalfX = this.container.offsetWidth / 2;
        this.windowHalfY = this.container.offsetHeight / 2;
        this.camera.aspect = this.container.offsetWidth / this.container.offsetHeight;
        this.camera.updateProjectionMatrix();
        this.renderer.setSize(this.container.offsetWidth, this.container.offsetHeight);
    };
    Viewer3DComponent.prototype.render = function () {
        if (this.transformControl) {
            this.transformControl.update();
        }
        this.renderer.render(this.scene, this.camera);
    };
    Viewer3DComponent.prototype.isLoading = function () {
        return this.loading;
    };
    Viewer3DComponent.prototype.getFileExtension = function (fileName) {
        return fileName.split('.').pop().toLowerCase();
    };
    return Viewer3DComponent;
}());
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], Viewer3DComponent.prototype, "urlFile", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], Viewer3DComponent.prototype, "extension", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", String)
], Viewer3DComponent.prototype, "clearColor", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], Viewer3DComponent.prototype, "initialPositionCamera", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], Viewer3DComponent.prototype, "initialRotationCamera", void 0);
__decorate([
    core_1.Input(),
    __metadata("design:type", Object)
], Viewer3DComponent.prototype, "enableTransformController", void 0);
Viewer3DComponent = __decorate([
    core_1.Component({
        selector: 'threed-viewer',
        template: " <div class=\"loader-container\"  *ngIf=\"isLoading()\" >     <div class=\"loader\">         <h1>LOADING {{detailLoading}}</h1>         <span></span>         <span></span>         <span></span>     </div> </div>  <div class=\"viewer-3d-content\">     <div class=\"viewer-3d-row\">         <div class=\"viewer-3d-cell\">             <div id=\"viewer-3d\" class=\"viewer-3d\">             </div>         </div>     </div> </div>",
        styles: [" .viewer-3d-content {     font-family: Monospace;     background-color: #000;     color: #fff;     margin: 0px;     overflow: hidden; }  .viewer-3d-row {     display: -webkit-box;     display: -moz-box;     display: -ms-flexbox;     display: -webkit-flex;     display: flex;      -webkit-box-orient: horizontal;     -moz-box-orient: horizontal;     box-orient: horizontal;     flex-direction: row;      -webkit-box-pack: center;     -moz-box-pack: center;     box-pack: center;     justify-content: center;      -webkit-box-align: center;     -moz-box-align: center;     box-align: center;     align-items: center; }  .viewer-3d-cell {     -webkit-box-flex: 1;     -moz-box-flex: 1;     box-flex: 1;     -webkit-flex: 1 1 auto;     flex: 1 1 auto;      padding: 10px;     margin: 10px;      text-align: center; }  .viewer-3d {     height: 80vh;     max-width: 100%; }  .loader-container{     width: 200px;     height: 200px;     top: 0;     bottom: 0;     margin: auto;     position: absolute;     left: 0;     right: 0; }  .loader{     background:#333;  }  h1{     font-family: 'Actor', sans-serif;     color:#FFF;     font-size:16px;     letter-spacing:1px;     font-weight:200;     text-align:center; } .loader span{     width:16px;     height:16px;     border-radius:50%;     display:inline-block;     position:absolute;     left:50%;     margin-left:-10px;     -webkit-animation:3s infinite linear;     -moz-animation:3s infinite linear;     -o-animation:3s infinite linear;  }   .loader span:nth-child(2){     background:#E84C3D;     -webkit-animation:kiri 1.2s infinite linear;     -moz-animation:kiri 1.2s infinite linear;     -o-animation:kiri 1.2s infinite linear;  } .loader span:nth-child(3){     background:#F1C40F;     z-index:100; } .loader span:nth-child(4){     background:#2FCC71;     -webkit-animation:kanan 1.2s infinite linear;     -moz-animation:kanan 1.2s infinite linear;     -o-animation:kanan 1.2s infinite linear; }   @-webkit-keyframes kanan {     0% {-webkit-transform:translateX(20px);     }      50%{-webkit-transform:translateX(-20px);     }      100%{-webkit-transform:translateX(20px);         z-index:200;     } } @-moz-keyframes kanan {     0% {-moz-transform:translateX(20px);     }      50%{-moz-transform:translateX(-20px);     }      100%{-moz-transform:translateX(20px);         z-index:200;     } } @-o-keyframes kanan {     0% {-o-transform:translateX(20px);     }      50%{-o-transform:translateX(-20px);     }      100%{-o-transform:translateX(20px);         z-index:200;     } }     @-webkit-keyframes kiri {     0% {-webkit-transform:translateX(-20px);         z-index:200;     }     50%{-webkit-transform:translateX(20px);     }     100%{-webkit-transform:translateX(-20px);     } }  @-moz-keyframes kiri {     0% {-moz-transform:translateX(-20px);         z-index:200;     }     50%{-moz-transform:translateX(20px);     }     100%{-moz-transform:translateX(-20px);     } } @-o-keyframes kiri {     0% {-o-transform:translateX(-20px);         z-index:200;     }     50%{-o-transform:translateX(20px);     }     100%{-o-transform:translateX(-20px);     } }"]
    })
], Viewer3DComponent);
exports.Viewer3DComponent = Viewer3DComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmV0cy92aWV3ZXIzRC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLHNDQUFpRDtBQUNqRCxnRUFBK0Q7QUFFL0QsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzdCLElBQUksZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7QUFDckUsSUFBSSxpQkFBaUIsR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQztBQUMzRCxJQUFJLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ2pFLElBQUksZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFPakUsSUFBYSxpQkFBaUI7SUFMOUI7UUF1QkksOEJBQXlCLEdBQVEsSUFBSSxDQUFDO1FBRXRDLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFNNUIsV0FBTSxHQUFXLENBQUMsQ0FBQztRQUNuQixXQUFNLEdBQVcsQ0FBQyxDQUFDO1FBS25CLFdBQU0sR0FBUSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUVsQyxZQUFPLEdBQVksSUFBSSxDQUFDO0lBa1A1QixDQUFDO0lBL09HLG9DQUFRLEdBQVI7UUFBQSxpQkEwRkM7UUF6RkcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzlCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDOUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUV0RCxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksS0FBSyxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFB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TyxDQUFDO0lBQ3hCLENBQUM7SUFFRCw0Q0FBZ0IsR0FBaEIsVUFBaUIsUUFBZ0I7UUFDN0IsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDbkQsQ0FBQztJQUNMLHdCQUFDO0FBQUQsQ0FwUkEsQUFvUkMsSUFBQTtBQWpSRztJQURDLFlBQUssRUFBRTs7a0RBQ1E7QUFHaEI7SUFEQyxZQUFLLEVBQUU7O29EQUNVO0FBR2xCO0lBREMsWUFBSyxFQUFFOztxREFDVztBQUduQjtJQURDLFlBQUssRUFBRTs7Z0VBQ21CO0FBRzNCO0lBREMsWUFBSyxFQUFFOztnRUFDbUI7QUFHM0I7SUFEQyxZQUFLLEVBQUU7O29FQUM4QjtBQWxCN0IsaUJBQWlCO0lBTDdCLGdCQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsZUFBZTtRQUN6QixRQUFRLEVBQUUsNGFBQTRhO1FBQ3RiLE1BQU0sRUFBRSxDQUFDLGlpR0FBaWlHLENBQUM7S0FDOWlHLENBQUM7R0FDVyxpQkFBaUIsQ0FvUjdCO0FBcFJZLDhDQUFpQiIsImZpbGUiOiJjb21wb25ldHMvdmlld2VyM0QuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRWRpdG9yQ29udHJvbHMgfSBmcm9tICcuLi9jb250cm9sbGVycy9lZGl0b3JDb250cm9scyc7XG5cbmxldCBUSFJFRSA9IHJlcXVpcmUoJ3RocmVlJyk7XG5sZXQgRkJYTG9hZGVyU2VydmljZSA9IHJlcXVpcmUoJy4uL2pzc2VydmljZS9mYnhMb2FkZXIyLnNlcnZpY2UuanMnKTtcbmxldCBUcmFuc2Zvcm1Db250cm9scyA9IHJlcXVpcmUoJ3RocmVlLXRyYW5zZm9ybWNvbnRyb2xzJyk7XG5sZXQgT2JqTG9hZGVyU2VydmljZSA9IHJlcXVpcmUoJy4uL2pzc2VydmljZS9vYmpMb2FkZXIuc2VydmljZScpO1xubGV0IE10bExvYWRlclNlcnZpY2UgPSByZXF1aXJlKCcuLi9qc3NlcnZpY2UvbXRsTG9hZGVyLnNlcnZpY2UnKTtcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICd0aHJlZWQtdmlld2VyJyxcbiAgICB0ZW1wbGF0ZTogXCIgPGRpdiBjbGFzcz1cXFwibG9hZGVyLWNvbnRhaW5lclxcXCIgICpuZ0lmPVxcXCJpc0xvYWRpbmcoKVxcXCIgPiAgICAgPGRpdiBjbGFzcz1cXFwibG9hZGVyXFxcIj4gICAgICAgICA8aDE+TE9BRElORyB7e2RldGFpbExvYWRpbmd9fTwvaDE+ICAgICAgICAgPHNwYW4+PC9zcGFuPiAgICAgICAgIDxzcGFuPjwvc3Bhbj4gICAgICAgICA8c3Bhbj48L3NwYW4+ICAgICA8L2Rpdj4gPC9kaXY+ICA8ZGl2IGNsYXNzPVxcXCJ2aWV3ZXItM2QtY29udGVudFxcXCI+ICAgICA8ZGl2IGNsYXNzPVxcXCJ2aWV3ZXItM2Qtcm93XFxcIj4gICAgICAgICA8ZGl2IGNsYXNzPVxcXCJ2aWV3ZXItM2QtY2VsbFxcXCI+ICAgICAgICAgICAgIDxkaXYgaWQ9XFxcInZpZXdlci0zZFxcXCIgY2xhc3M9XFxcInZpZXdlci0zZFxcXCI+ICAgICAgICAgICAgIDwvZGl2PiAgICAgICAgIDwvZGl2PiAgICAgPC9kaXY+IDwvZGl2PlwiLFxuICAgIHN0eWxlczogW1wiIC52aWV3ZXItM2QtY29udGVudCB7ICAgICBmb250LWZhbWlseTogTW9ub3NwYWNlOyAgICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDsgICAgIGNvbG9yOiAjZmZmOyAgICAgbWFyZ2luOiAwcHg7ICAgICBvdmVyZmxvdzogaGlkZGVuOyB9ICAudmlld2VyLTNkLXJvdyB7ICAgICBkaXNwbGF5OiAtd2Via2l0LWJveDsgICAgIGRpc3BsYXk6IC1tb3otYm94OyAgICAgZGlzcGxheTogLW1zLWZsZXhib3g7ICAgICBkaXNwbGF5OiAtd2Via2l0LWZsZXg7ICAgICBkaXNwbGF5OiBmbGV4OyAgICAgIC13ZWJraXQtYm94LW9yaWVudDogaG9yaXpvbnRhbDsgICAgIC1tb3otYm94LW9yaWVudDogaG9yaXpvbnRhbDsgICAgIGJveC1vcmllbnQ6IGhvcml6b250YWw7ICAgICBmbGV4LWRpcmVjdGlvbjogcm93OyAgICAgIC13ZWJraXQtYm94LXBhY2s6IGNlbnRlcjsgICAgIC1tb3otYm94LXBhY2s6IGNlbnRlcjsgICAgIGJveC1wYWNrOiBjZW50ZXI7ICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsgICAgICAtd2Via2l0LWJveC1hbGlnbjogY2VudGVyOyAgICAgLW1vei1ib3gtYWxpZ246IGNlbnRlcjsgICAgIGJveC1hbGlnbjogY2VudGVyOyAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsgfSAgLnZpZXdlci0zZC1jZWxsIHsgICAgIC13ZWJraXQtYm94LWZsZXg6IDE7ICAgICAtbW96LWJveC1mbGV4OiAxOyAgICAgYm94LWZsZXg6IDE7ICAgICAtd2Via2l0LWZsZXg6IDEgMSBhdXRvOyAgICAgZmxleDogMSAxIGF1dG87ICAgICAgcGFkZGluZzogMTBweDsgICAgIG1hcmdpbjogMTBweDsgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7IH0gIC52aWV3ZXItM2QgeyAgICAgaGVpZ2h0OiA4MHZoOyAgICAgbWF4LXdpZHRoOiAxMDAlOyB9ICAubG9hZGVyLWNvbnRhaW5lcnsgICAgIHdpZHRoOiAyMDBweDsgICAgIGhlaWdodDogMjAwcHg7ICAgICB0b3A6IDA7ICAgICBib3R0b206IDA7ICAgICBtYXJnaW46IGF1dG87ICAgICBwb3NpdGlvbjogYWJzb2x1dGU7ICAgICBsZWZ0OiAwOyAgICAgcmlnaHQ6IDA7IH0gIC5sb2FkZXJ7ICAgICBiYWNrZ3JvdW5kOiMzMzM7ICB9ICBoMXsgICAgIGZvbnQtZmFtaWx5OiAnQWN0b3InLCBzYW5zLXNlcmlmOyAgICAgY29sb3I6I0ZGRjsgICAgIGZvbnQtc2l6ZToxNnB4OyAgICAgbGV0dGVyLXNwYWNpbmc6MXB4OyAgICAgZm9udC13ZWlnaHQ6MjAwOyAgICAgdGV4dC1hbGlnbjpjZW50ZXI7IH0gLmxvYWRlciBzcGFueyAgICAgd2lkdGg6MTZweDsgICAgIGhlaWdodDoxNnB4OyAgICAgYm9yZGVyLXJhZGl1czo1MCU7ICAgICBkaXNwbGF5OmlubGluZS1ibG9jazsgICAgIHBvc2l0aW9uOmFic29sdXRlOyAgICAgbGVmdDo1MCU7ICAgICBtYXJnaW4tbGVmdDotMTBweDsgICAgIC13ZWJraXQtYW5pbWF0aW9uOjNzIGluZmluaXRlIGxpbmVhcjsgICAgIC1tb3otYW5pbWF0aW9uOjNzIGluZmluaXRlIGxpbmVhcjsgICAgIC1vLWFuaW1hdGlvbjozcyBpbmZpbml0ZSBsaW5lYXI7ICB9ICAgLmxvYWRlciBzcGFuOm50aC1jaGlsZCgyKXsgICAgIGJhY2tncm91bmQ6I0U4NEMzRDsgICAgIC13ZWJraXQtYW5pbWF0aW9uOmtpcmkgMS4ycyBpbmZpbml0ZSBsaW5lYXI7ICAgICAtbW96LWFuaW1hdGlvbjpraXJpIDEuMnMgaW5maW5pdGUgbGluZWFyOyAgICAgLW8tYW5pbWF0aW9uOmtpcmkgMS4ycyBpbmZpbml0ZSBsaW5lYXI7ICB9IC5sb2FkZXIgc3BhbjpudGgtY2hpbGQoMyl7ICAgICBiYWNrZ3JvdW5kOiNGMUM0MEY7ICAgICB6LWluZGV4OjEwMDsgfSAubG9hZGVyIHNwYW46bnRoLWNoaWxkKDQpeyAgICAgYmFja2dyb3VuZDojMkZDQzcxOyAgICAgLXdlYmtpdC1hbmltYXRpb246a2FuYW4gMS4ycyBpbmZpbml0ZSBsaW5lYXI7ICAgICAtbW96LWFuaW1hdGlvbjprYW5hbiAxLjJzIGluZmluaXRlIGxpbmVhcjsgICAgIC1vLWFuaW1hdGlvbjprYW5hbiAxLjJzIGluZmluaXRlIGxpbmVhcjsgfSAgIEAtd2Via2l0LWtleWZyYW1lcyBrYW5hbiB7ICAgICAwJSB7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlWCgyMHB4KTsgICAgIH0gICAgICA1MCV7LXdlYmtpdC10cmFuc2Zvcm06dHJhbnNsYXRlWCgtMjBweCk7ICAgICB9ICAgICAgMTAwJXstd2Via2l0LXRyYW5zZm9ybTp0cmFuc2xhdGVYKDIwcHgpOyAgICAgICAgIHotaW5kZXg6MjAwOyAgICAgfSB9IEAtbW96LWtleWZyYW1lcyBrYW5hbiB7ICAgICAwJSB7LW1vei10cmFuc2Zvcm06dHJhbnNsYXRlWCgyMHB4KTsgICAgIH0gICAgICA1MCV7LW1vei10cmFuc2Zvcm06dHJhbnNsYXRlWCgtMjBweCk7ICAgICB9ICAgICAgMTAwJXstbW96LXRyYW5zZm9ybTp0cmFuc2xhdGVYKDIwcHgpOyAgICAgICAgIHotaW5kZXg6MjAwOyAgICAgfSB9IEAtby1rZXlmcmFtZXMga2FuYW4geyAgICAgMCUgey1vLXRyYW5zZm9ybTp0cmFuc2xhdGVYKDIwcHgpOyAgICAgfSAgICAgIDUwJXstby10cmFuc2Zvcm06dHJhbnNsYXRlWCgtMjBweCk7ICAgICB9ICAgICAgMTAwJXstby10cmFuc2Zvcm06dHJhbnNsYXRlWCgyMHB4KTsgICAgICAgICB6LWluZGV4OjIwMDsgICAgIH0gfSAgICAgQC13ZWJraXQta2V5ZnJhbWVzIGtpcmkgeyAgICAgMCUgey13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTIwcHgpOyAgICAgICAgIHotaW5kZXg6MjAwOyAgICAgfSAgICAgNTAley13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZVgoMjBweCk7ICAgICB9ICAgICAxMDAley13ZWJraXQtdHJhbnNmb3JtOnRyYW5zbGF0ZVgoLTIwcHgpOyAgICAgfSB9ICBALW1vei1rZXlmcmFtZXMga2lyaSB7ICAgICAwJSB7LW1vei10cmFuc2Zvcm06dHJhbnNsYXRlWCgtMjBweCk7ICAgICAgICAgei1pbmRleDoyMDA7ICAgICB9ICAgICA1MCV7LW1vei10cmFuc2Zvcm06dHJhbnNsYXRlWCgyMHB4KTsgICAgIH0gICAgIDEwMCV7LW1vei10cmFuc2Zvcm06dHJhbnNsYXRlWCgtMjBweCk7ICAgICB9IH0gQC1vLWtleWZyYW1lcyBraXJpIHsgICAgIDAlIHstby10cmFuc2Zvcm06dHJhbnNsYXRlWCgtMjBweCk7ICAgICAgICAgei1pbmRleDoyMDA7ICAgICB9ICAgICA1MCV7LW8tdHJhbnNmb3JtOnRyYW5zbGF0ZVgoMjBweCk7ICAgICB9ICAgICAxMDAley1vLXRyYW5zZm9ybTp0cmFuc2xhdGVYKC0yMHB4KTsgICAgIH0gfVwiXVxufSlcbmV4cG9ydCBjbGFzcyBWaWV3ZXIzRENvbXBvbmVudCB7XG5cbiAgICBASW5wdXQoKVxuICAgIHVybEZpbGU6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgZXh0ZW5zaW9uOiBzdHJpbmc7XG5cbiAgICBASW5wdXQoKVxuICAgIGNsZWFyQ29sb3I6IHN0cmluZztcblxuICAgIEBJbnB1dCgpXG4gICAgaW5pdGlhbFBvc2l0aW9uQ2FtZXJhOiBhbnk7XG5cbiAgICBASW5wdXQoKVxuICAgIGluaXRpYWxSb3RhdGlvbkNhbWVyYTogYW55O1xuXG4gICAgQElucHV0KClcbiAgICBlbmFibGVUcmFuc2Zvcm1Db250cm9sbGVyOiBhbnkgPSB0cnVlO1xuXG4gICAgaW5HZW5lcmF0ZTogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgY29udGFpbmVyOiBhbnk7XG4gICAgY2FtZXJhOiBhbnk7XG4gICAgc2NlbmU6IGFueTtcbiAgICByZW5kZXJlcjogYW55O1xuICAgIG1vdXNlWDogbnVtYmVyID0gMDtcbiAgICBtb3VzZVk6IG51bWJlciA9IDA7XG4gICAgd2luZG93SGFsZlk6IGFueTtcbiAgICB3aW5kb3dIYWxmWDogYW55O1xuICAgIGNvbnRyb2xsZXJzOiBFZGl0b3JDb250cm9scztcbiAgICB0cmFuc2Zvcm1Db250cm9sOiBhbnk7XG4gICAgY2VudGVyOiBhbnkgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xuXG4gICAgbG9hZGluZzogYm9vbGVhbiA9IHRydWU7XG4gICAgZGV0YWlsTG9hZGluZzogc3RyaW5nO1xuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKE9iakxvYWRlclNlcnZpY2UpO1xuICAgICAgICBjb25zb2xlLmxvZyhNdGxMb2FkZXJTZXJ2aWNlKTtcbiAgICAgICAgY29uc29sZS5sb2coRkJYTG9hZGVyU2VydmljZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFRyYW5zZm9ybUNvbnRyb2xzKTtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmlld2VyLTNkJyk7XG5cbiAgICAgICAgdGhpcy5jYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNDUsIHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0LCAxLCAyMDAwKTtcbiAgICAgICAgdGhpcy5jYW1lcmEucG9zaXRpb24ueiA9IDI1MDtcbiAgICAgICAgLy8gc2NlbmVcbiAgICAgICAgdGhpcy5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xuXG4gICAgICAgIHRoaXMubGlnaHRzKCk7XG5cbiAgICAgICAgdGhpcy5ncmlkKCk7XG5cbiAgICAgICAgdGhpcy5heGlzSGVscGVyKCk7XG5cbiAgICAgICAgaWYgKCF0aGlzLmV4dGVuc2lvbikge1xuICAgICAgICAgICAgdGhpcy5leHRlbnNpb24gPSB0aGlzLmdldEZpbGVFeHRlbnNpb24odGhpcy51cmxGaWxlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmV4dGVuc2lvbiA9PT0gJ29iaicpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZE9iakZvcm1hdEZpbGUoKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmV4dGVuc2lvbiA9PT0gJ2ZieCcpIHtcbiAgICAgICAgICAgIHRoaXMubG9hZEZieEZvcm1hdEZpbGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMucmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFNpemUod2luZG93LmlubmVyV2lkdGgsIHdpbmRvdy5pbm5lckhlaWdodCk7XG5cbiAgICAgICAgaWYgKHRoaXMuY2xlYXJDb2xvcikge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRDbGVhckNvbG9yKHRoaXMuY2xlYXJDb2xvcik7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQpO1xuXG4gICAgICAgIHRoaXMuYW5pbWF0ZSgpO1xuXG4gICAgICAgIGlmICh0aGlzLmVuYWJsZVRyYW5zZm9ybUNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ29udHJvbCA9IG5ldyBUcmFuc2Zvcm1Db250cm9scyh0aGlzLmNhbWVyYSwgdGhpcy5yZW5kZXJlci5kb21FbGVtZW50KTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB0aGlzLnJlbmRlci5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29udHJvbGxlcnMgPSBuZXcgRWRpdG9yQ29udHJvbHModGhpcy5jb250YWluZXIsIHRoaXMuY2FtZXJhKTtcblxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vbldpbmRvd1Jlc2l6ZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgODE6IC8vIFFcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1Db250cm9sLnNldFNwYWNlKHRoaXMudHJhbnNmb3JtQ29udHJvbC5zcGFjZSA9PT0gJ2xvY2FsJyA/ICd3b3JsZCcgOiAnbG9jYWwnKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxNzogLy8gQ3RybFxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUNvbnRyb2wuc2V0VHJhbnNsYXRpb25TbmFwKDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ29udHJvbC5zZXRSb3RhdGlvblNuYXAoVEhSRUUuTWF0aC5kZWdUb1JhZCgxNSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDg3OiAvLyBXXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ29udHJvbC5zZXRNb2RlKCd0cmFuc2xhdGUnKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA2OTogLy8gRVxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUNvbnRyb2wuc2V0TW9kZSgncm90YXRlJyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgODI6IC8vIFJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1Db250cm9sLnNldE1vZGUoJ3NjYWxlJyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTg3OlxuICAgICAgICAgICAgICAgIGNhc2UgMTA3OiAvLyArLCA9LCBudW0rXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ29udHJvbC5zZXRTaXplKHRoaXMudHJhbnNmb3JtQ29udHJvbC5zaXplICsgMC4xKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxODk6XG4gICAgICAgICAgICAgICAgY2FzZSAxMDk6IC8vIC0sIF8sIG51bS1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2Zvcm1Db250cm9sLnNldFNpemUoTWF0aC5tYXgodGhpcy50cmFuc2Zvcm1Db250cm9sLnNpemUgLSAwLjEsIDAuMSkpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE3OiAvLyBDdHJsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ29udHJvbC5zZXRUcmFuc2xhdGlvblNuYXAobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNmb3JtQ29udHJvbC5zZXRSb3RhdGlvblNuYXAobnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBsaWdodHMoKSB7XG4gICAgICAgIGxldCBhbWJpZW50ID0gbmV3IFRIUkVFLkFtYmllbnRMaWdodCgweDQ0NDQ0NCk7XG5cbiAgICAgICAgbGV0IGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZiwgMSk7XG4gICAgICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KDEsIDEsIDEpLm5vcm1hbGl6ZSgpO1xuXG4gICAgICAgIGxldCBoZWxwZXIgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodEhlbHBlcihkaXJlY3Rpb25hbExpZ2h0LCA1KTtcblxuICAgICAgICB0aGlzLnNjZW5lLmFkZChhbWJpZW50KTtcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQoaGVscGVyKTtcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQoZGlyZWN0aW9uYWxMaWdodCk7XG4gICAgfVxuXG4gICAgYXhpc0hlbHBlcigpIHtcbiAgICAgICAgbGV0IGF4aXNIZWxwZXIgPSBuZXcgVEhSRUUuQXhpc0hlbHBlcig1KTtcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQoYXhpc0hlbHBlcik7XG4gICAgfVxuXG4gICAgZ3JpZCgpIHtcbiAgICAgICAgbGV0IGxpbmVNYXRlcmlhbCA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7Y29sb3I6IDB4MzAzMDMwfSksXG4gICAgICAgICAgICBnZW9tZXRyeSA9IG5ldyBUSFJFRS5HZW9tZXRyeSgpLFxuICAgICAgICAgICAgZmxvb3IgPSAtNzUsIHN0ZXAgPSAyNTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gNDA7IGkrKykge1xuICAgICAgICAgICAgZ2VvbWV0cnkudmVydGljZXMucHVzaChuZXcgVEhSRUUuVmVjdG9yMygtNTAwLCBmbG9vciwgaSAqIHN0ZXAgLSA1MDApKTtcbiAgICAgICAgICAgIGdlb21ldHJ5LnZlcnRpY2VzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoNTAwLCBmbG9vciwgaSAqIHN0ZXAgLSA1MDApKTtcbiAgICAgICAgICAgIGdlb21ldHJ5LnZlcnRpY2VzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoaSAqIHN0ZXAgLSA1MDAsIGZsb29yLCAtNTAwKSk7XG4gICAgICAgICAgICBnZW9tZXRyeS52ZXJ0aWNlcy5wdXNoKG5ldyBUSFJFRS5WZWN0b3IzKGkgKiBzdGVwIC0gNTAwLCBmbG9vciwgNTAwKSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGxpbmUgPSBuZXcgVEhSRUUuTGluZVNlZ21lbnRzKGdlb21ldHJ5LCBsaW5lTWF0ZXJpYWwpO1xuICAgICAgICB0aGlzLnNjZW5lLmFkZChsaW5lKTtcbiAgICB9XG5cbiAgICBsb2FkT2JqRm9ybWF0RmlsZSgpIHtcbiAgICAgICAgbGV0IG10bExvYWRlciA9IG5ldyBUSFJFRS5NVExMb2FkZXIoKTtcblxuICAgICAgICB0aGlzLnNldERldGFpbExvYWQoJ01BVEVSSUFMUycpO1xuXG4gICAgICAgIG10bExvYWRlci5sb2FkKHRoaXMudXJsRmlsZS5yZXBsYWNlKCcub2JqJywgJy5tdGwnKSwgKG1hdGVyaWFscykgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2FkT2JqKG1hdGVyaWFscyk7XG4gICAgICAgIH0sIChwcm9ncmVzcykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2dyZXNzIG1hdGVyaWFsIGxvYWRlcicgKyBKU09OLnN0cmluZ2lmeShwcm9ncmVzcykpO1xuICAgICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvciBtYXRlcmlhbCBsb2FkZXInICsgZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy5sb2FkT2JqKG51bGwpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBsb2FkRmJ4Rm9ybWF0RmlsZSgpIHtcbiAgICAgICAgdGhpcy5zZXREZXRhaWxMb2FkKCdGQlggT0JKRUNUUycpO1xuXG4gICAgICAgIGxldCBtYW5hZ2VyID0gbmV3IFRIUkVFLkxvYWRpbmdNYW5hZ2VyKCk7XG4gICAgICAgIG1hbmFnZXIub25Qcm9ncmVzcyA9IGZ1bmN0aW9uIChpdGVtLCBsb2FkZWQsIHRvdGFsKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpdGVtLCBsb2FkZWQsIHRvdGFsKTtcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgbG9hZGVyID0gbmV3IFRIUkVFLkZCWExvYWRlcihtYW5hZ2VyKTtcbiAgICAgICAgbG9hZGVyLmxvYWQodGhpcy51cmxGaWxlLCAob2JqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgb2JqZWN0Lm1peGVyID0gbmV3IFRIUkVFLkFuaW1hdGlvbk1peGVyKG9iamVjdCk7XG4gICAgICAgICAgICBsZXQgYWN0aW9uID0gb2JqZWN0Lm1peGVyLmNsaXBBY3Rpb24ob2JqZWN0LmFuaW1hdGlvbnNbMF0pO1xuICAgICAgICAgICAgYWN0aW9uLnBsYXkoKTtcbiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKG9iamVjdCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVuYWJsZVRyYW5zZm9ybUNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUNvbnRyb2wuYXR0YWNoKG9iamVjdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy50cmFuc2Zvcm1Db250cm9sKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LCAocHJvZ3Jlc3MpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwcm9ncmVzcyBmYnggbG9hZGVyJyArIEpTT04uc3RyaW5naWZ5KHByb2dyZXNzKSk7XG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJyArIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbG9hZE9iaihtYXRlcmlhbHM6IGFueSkge1xuICAgICAgICBsZXQgb2JqTG9hZGVyID0gbmV3IFRIUkVFLk9CSkxvYWRlcigpO1xuXG4gICAgICAgIGlmIChtYXRlcmlhbHMpIHtcbiAgICAgICAgICAgIG1hdGVyaWFscy5wcmVsb2FkKCk7XG4gICAgICAgICAgICBvYmpMb2FkZXIuc2V0TWF0ZXJpYWxzKG1hdGVyaWFscyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldERldGFpbExvYWQoJ09CSiBPQkpFQ1RTJyk7XG5cbiAgICAgICAgb2JqTG9hZGVyLmxvYWQodGhpcy51cmxGaWxlLCAob2JqZWN0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc2NlbmUuYWRkKG9iamVjdCk7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmVuYWJsZVRyYW5zZm9ybUNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUNvbnRyb2wuYXR0YWNoKG9iamVjdCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5hZGQodGhpcy50cmFuc2Zvcm1Db250cm9sKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5jYW1lcmFQb3NpdGlvbmluZygpO1xuXG4gICAgICAgIH0sIChwcm9ncmVzcykgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3Byb2dyZXNzIG9iaiBsb2FkZXInICsgSlNPTi5zdHJpbmdpZnkocHJvZ3Jlc3MpKTtcbiAgICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InICsgZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjYW1lcmFQb3NpdGlvbmluZygpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5pdGlhbFBvc2l0aW9uQ2FtZXJhKSB7XG4gICAgICAgICAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi5zZXQodGhpcy5pbml0aWFsUG9zaXRpb25DYW1lcmEueCwgdGhpcy5pbml0aWFsUG9zaXRpb25DYW1lcmEueSwgdGhpcy5pbml0aWFsUG9zaXRpb25DYW1lcmEueik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5pbml0aWFsUm90YXRpb25DYW1lcmEpIHtcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhLnJvdGF0aW9uLnNldCh0aGlzLmluaXRpYWxSb3RhdGlvbkNhbWVyYS54LCB0aGlzLmluaXRpYWxSb3RhdGlvbkNhbWVyYS55LCB0aGlzLmluaXRpYWxSb3RhdGlvbkNhbWVyYS56KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY2FtZXJhLmxvb2tBdCh0aGlzLmNlbnRlcik7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXREZXRhaWxMb2FkKGRldGFpbCkge1xuICAgICAgICB0aGlzLmRldGFpbExvYWRpbmcgPSBkZXRhaWw7XG4gICAgfTtcblxuICAgIGFuaW1hdGUoKSB7XG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLmFuaW1hdGUuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgfVxuXG4gICAgb25XaW5kb3dSZXNpemUoKSB7XG4gICAgICAgIHRoaXMud2luZG93SGFsZlggPSB0aGlzLmNvbnRhaW5lci5vZmZzZXRXaWR0aCAvIDI7XG4gICAgICAgIHRoaXMud2luZG93SGFsZlkgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXRIZWlnaHQgLyAyO1xuICAgICAgICB0aGlzLmNhbWVyYS5hc3BlY3QgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXRXaWR0aCAvIHRoaXMuY29udGFpbmVyLm9mZnNldEhlaWdodDtcbiAgICAgICAgdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFNpemUodGhpcy5jb250YWluZXIub2Zmc2V0V2lkdGgsIHRoaXMuY29udGFpbmVyLm9mZnNldEhlaWdodCk7XG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBpZiAodGhpcy50cmFuc2Zvcm1Db250cm9sKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zZm9ybUNvbnRyb2wudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW5kZXIodGhpcy5zY2VuZSwgdGhpcy5jYW1lcmEpO1xuICAgIH1cblxuICAgIGlzTG9hZGluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGluZztcbiAgICB9XG5cbiAgICBnZXRGaWxlRXh0ZW5zaW9uKGZpbGVOYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIGZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCkudG9Mb3dlckNhc2UoKTtcbiAgICB9XG59XG4iXX0=
